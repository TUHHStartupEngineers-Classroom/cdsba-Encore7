---
title: "Instrumental Variables"
---

# Assignment 

------------------------------------------------------------------------

> Loading data set rand_enc

```{r}
df_rand_enc <- readRDS("../../Causal_Data_Science_Data/rand_enc.rds")
df_rand_enc
```

### Task 1:

```{r}
dag <- dagify(
  Y ~ D,
  Y ~ U,
  D ~ U,
  D ~ Z,
  exposure = "D",
  latent = "U",
  outcome = "Y",
  coords = list(x = c(U = 1, D = 0, Y = 2, Z = -1),
                y = c(U = 1, D = 0, Y = 0, Z = 0)),
  labels = c("D" = "Pop-up Feature", 
             "Y" = "App Usage", 
             "U" = "Unobserved Factor",
             "Z" = "Encouragement")
)
ggdag(dag, text = T) +
  theme_dag() +
  theme(plot.background = element_rect(fill = "lightblue"))
```

### Task 2:

```{r}
model_biased <- lm(time_spent ~ used_ftr, data = df_rand_enc)
summary(model_biased)
```

### Task 3:

```{r}
cor(df_rand_enc)
```
>Correlation Analysis:

The correlation between rand_enc and used_ftr is 0.204, indicating a weak positive correlation.
The correlation between used_ftr and time_spent is 0.705, indicating a moderate to strong positive correlation.
The correlation between rand_enc and time_spent is 0.130, indicating a weak positive correlation.

>Assumptions for Instrumental Variable Estimation:

Instrumental variable (IV) estimation relies on several key assumptions:

* Relevance: 

  + The instrumental variable should be correlated with the endogenous variable (used_ftr) but not directly related to the outcome variable (time_spent).

  + Based on the correlation matrix, it's important to check whether rand_enc is a relevant instrument. A correlation of 0.204 with used_ftr suggests some relevance.

* Exogeneity: 

  + The instrumental variable should be uncorrelated with the error term in the regression of the endogenous variable on the instruments.

  + This assumption may not be directly observable from the correlation matrix. It requires further testing, such as examining residual plots.

* No Measurement Error: 

  + The instrumental variable should be measured precisely and not subject to measurement error.

  + This assumption cannot be directly assessed from the correlation matrix and may require additional information about the measurement process.
 
* Independence: 

  + The instrumental variable should be independent of unobserved factors that affect the outcome variable.

  + This assumption is challenging to test directly. It requires careful consideration of potential confounding factors and unobserved variables.

>Overall Assessment:

* The correlation between rand_enc and used_ftr suggests some relevance, but other assumptions require more detailed investigation.
It's essential to conduct further diagnostic tests, such as examining residuals, testing for endogeneity, and considering the potential impact of unobserved variables.
Consideration:

* Instrumental variable estimation may be considered if the assumptions are met or found to be reasonable after thorough testing.
However, the decision to use instrumental variables should be made cautiously, and the results should be interpreted with awareness of the assumptions and potential limitations.

### Task 4:

```{r}
library(estimatr)

model_iv <- iv_robust(time_spent ~ used_ftr | rand_enc, data = df_rand_enc)
summary(model_iv)
```
The initial estimate stands at 10.82, while the Instrumental Variable (IV) estimate is marginally lower at 9.73. The initial estimate, often referred to as the naive estimate, tends to be on the higher side as it overlooks concealed factors associated with both feature usage and time spent on the app, commonly referred to as encouragement. The IV estimate rectifies this by accounting for these hidden factors, resulting in a more precise and slightly lower estimate. Unlike the naive estimate, which encompasses both the impact of feature usage on app time and the influence of encouragement, the IV estimate isolates the effect of feature usage, leading to a more accurate depiction.